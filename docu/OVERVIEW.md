**Overview**
PyPowerSim is a modular simulation toolkit for power converters. It focuses on readability and explicit signal flow so you can trace what happens from configuration to switching waveforms, electrical responses, loss models, and thermal models.

**High‑Level Flow**
1. Load configuration from `config/*.xlsx` in `src/data/loadSetup.py`.
2. Load parameters (switches, capacitors, transformer) in `src/data/loadPara.py`.
3. Sanity checks and derived inputs in `src/general/sanityCheck.py` and `src/general/genLoadInput.py`.
4. Generate transfer functions in `src/general/genTF.py`.
5. Instantiate topology class in `src/topo/initTopo.py`.
6. Run the selected analysis mode in `src/mode/**`.
7. Plot and optionally save results in `src/plot/plot.py` and `src/general/saveResults.py`.

**Core Data Structures**
Most simulations return:
1. `time`: time‑domain data and device/thermal data when available.
2. `freq`: frequency‑domain spectra.
3. `sweep`: sweep‑domain distortion and sweep grid (only for sweep mode).

The `time` dict typically contains:
1. `time['Sw']`: switching signals and references.
2. `time['Ac']`: AC‑side signals (voltages, currents).
3. `time['Dc']`: DC‑side signals (voltages, currents).
4. `time['Elec']`: device‑level electrical values (switch, cap, transformer).
5. `time['Loss']`: device‑level losses (switch, cap, transformer).
6. `time['Ther']`: device‑level temperatures.

**Operating Modes**
1. Sweep (`setup['Exp']['type'] = 0`): distortion vs. modulation index or DAB phase shift.
2. Steady‑state (`setup['Exp']['type'] = 1`): converged loss and thermal solution.
3. Transient (`setup['Exp']['type'] = 2`): time‑evolution with optional thermal feedback.
4. Closed‑loop (`setup['Exp']['type'] = 3`): controller loop with hysteresis or PI control.

**Topologies**
1. Inverter topologies: B2, B4, B6 classes in `src/topo/`.
2. DCDC topology: DAB in `src/topo/classDAB.py`.

Each class implements:
1. `calcPWM`: switching function generation.
2. `calcTime`: time‑domain electrical response.
3. `calcDist`: analytic distortion (if available).
4. `calcCON`: closed‑loop switching update.
5. `initOut`, `initData`, and `out`: output struct generation.

**DAB Specifics**
1. Phase shift `PhiDAB` defines the power transfer operating point.
2. Primary and secondary sides are modeled separately with `v_ac_pri`, `v_ac_sec`, `i_ac_pri`, `i_ac_sec`.
3. DC‑side includes `v_dc_pri`, `v_dc_sec`, `i_dc_pri`, `i_dc_sec`, `i_dc_in`, `i_dc_out`.

**Loss and Thermal Modeling**
1. Electrical losses are computed in `src/elec/` (switch, cap, transformer).
2. Thermal response uses reduced‑order RC models in `src/therm/`.
3. Coupling modes are configured via `setup['Par']['Ther']['Coupling']`.

**Outputs and Saving**
1. Result tables are printed by `src/plot/plotResults.py` or `src/plot/plotResults_DCDC.py`.
2. Plots are generated by `src/plot/plot.py`.
3. Results are optionally written to `results/` by `src/general/saveResults.py`.

**Limitations and Scope**
1. Many models are linear or piecewise linear and intended for educational use.
2. Transfer functions for filters are simplified and may require validation for high‑accuracy studies.
3. Soft‑switching extensions are not fully implemented.
